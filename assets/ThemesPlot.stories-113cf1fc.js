import{j as i,a as c,F as H}from"./jsx-runtime-095bf462.js";import{r as b}from"./index-8db94870.js";import{E as O}from"./ElementWithTooltip-5a50e333.js";import{u as W}from"./unCamelCase-81443ec7.js";import{m as j}from"./SynapseConstants-1ebc8be6.js";import"./getEndpoint-ac94413e.js";import{u as J,aY as K}from"./SynapseClient-3acc417d.js";import{r as B}from"./SqlFunctions-c9db38cf.js";import{c as U,P as X}from"./factory-837f2467.js";import{l as f}from"./lodash.default-43596fee.js";import{l as Z}from"./LoadingScreen-8ddf62a3.js";import"./_commonjsHelpers-042e6b4d.js";import"./SynapseTableConstants-942d2b0b.js";import"./IconSvg-d5f86620.js";import"./SvgIcon-147e032d.js";import"./extends-98964cd2.js";import"./objectWithoutPropertiesLoose-4f48578a.js";import"./styled-8ebe2b7d.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-29d231ba.js";import"./Tooltip-fcb4b0de.js";import"./useTheme-df5273c4.js";import"./ownerDocument-613eb639.js";import"./index-8ce4a492.js";import"./useForkRef-2674f3de.js";import"./useEnhancedEffect-c45cae33.js";import"./isHostComponent-73d6e646.js";import"./useControlled-be22aa93.js";import"./useEventCallback-65e61675.js";import"./utils-8d96ae5c.js";import"./inheritsLoose-c82a83d4.js";import"./TransitionGroupContext-53ae1513.js";import"./createSvgIcon-075f7759.js";import"./ErrorOutlined-0f626467.js";import"./InfoOutlined-3ee3099a.js";import"./CheckCircleTwoTone-64ad58ef.js";import"./RegularExpressions-bc0adf55.js";import"./Icon-735b4c02.js";import"./Button-5637ed55.js";import"./createWithBsPrefix-0fdadc7a.js";import"./index-58d3fd43.js";import"./hasClass-ec9efd32.js";import"./without-b068ad33.js";import"./_cacheHas-69a61c79.js";import"./_MapCache-c99e0be1.js";import"./_baseTimes-8cccc40f.js";import"./toString-cc90cb98.js";import"./isArray-5e3f9107.js";import"./isSymbol-7c514724.js";import"./_baseRest-dcfbd074.js";import"./isArrayLikeObject-a05de1f7.js";import"./hasIn-cb0345da.js";import"./_Uint8Array-c9b069dc.js";import"./_isIndex-af14b756.js";import"./pick-b632691e.js";import"./_baseClone-43b01424.js";import"./_baseSlice-cf92e063.js";import"./sortBy-b5eea065.js";import"./_setToArray-3d6ec6fd.js";import"./_baseFor-d254fa1e.js";import"./_isIterateeCall-72ce2fd1.js";import"./uniq-66cf4b90.js";import"./times-7ba1ed10.js";import"./Link-e1e47239.js";import"./Typography-fa1f2f14.js";import"./extendSxProp-8b7baf65.js";import"./dayjs.min-8d4ef725.js";import"./hoist-non-react-statics.cjs-775f1375.js";import"./inputBaseClasses-29b56ac5.js";import"./Fade-79bf68a5.js";import"./startCase-b2e198bb.js";import"./upperFirst-79e605a3.js";import"./omitBy-55573af2.js";import"./merge-f750d437.js";import"./uniqueId-4d05949d.js";import"./cloneDeep-4af97fae.js";import"./groupBy-64a7b454.js";import"./toLower-271fcf43.js";import"./LinearProgress-23f170d5.js";import"./emotion-react.browser.esm-cc724fea.js";import"./Backdrop-73d94df1.js";import"./Box-bbfe1a31.js";import"./Button-7a4e3dd9.js";import"./ButtonBase-92b85091.js";import"./assertThisInitialized-081f9914.js";const ee=U(X);function te(t,o){const e=f.cloneDeep(t);if(!o)return e;o.backgroundColor&&(e.plot_bgcolor=o.backgroundColor),e.yaxis.showticklabels=!1,e.xaxis.range=[-5,o.maxValue+30],e.xaxis.visible=o.isXAxis,e.showlegend=o.isLegend,e.margin={t:0,b:o.isXAxis?50:0,l:0,r:0,pad:15};let a=30;return o.isLegend&&(a=35,e.margin.pad=0,e.xaxis={visible:!1,zeroline:!1,showgrid:!1,showline:!1,range:[0,1]},e.yaxis={visible:!1,showline:!1}),o.isXAxis&&(e.yaxis={visible:!1,showgrid:!1,showline:!1},a=50),e.height=a,e}function oe(t,o){const e=new Array(t.length);return o.forEach(a=>{const r=t.indexOf(a.y);e[r]=a.x}),e}function re(t,o,e,a){const r=e===void 0,d=f.uniq(t.map(p=>p.group)),l=[],u=["y-down","triangle-up","cross-thin-open","triangle-up-open-dot","star-square-open","diamond-x"];return d.forEach((p,n)=>{l.push({type:"scatter",x:r?[-10]:oe(e,t.filter(g=>g.group===p)),y:e,text:[p],hovertemplate:"%{x} %{text}<extra></extra>",mode:"markers",name:p,marker:{color:o.markerFill,line:{color:o.markerLine,width:1},symbol:a?a[p]:u[n],size:o.markerSize}})}),l}const x=({plotData:t,optionsConfig:o,layoutConfig:e,label:a,id:r,xMax:d,style:l={width:"100%",height:"100%"},markerSymbols:u,plotStyle:p={markerFill:"#515359",markerLine:"#515359",markerSize:9,backgroundColor:"transparent"},onClick:n,isLegend:g=!1,isXAxis:P=!1})=>{const T=a?[a]:void 0;return i(ee,{layout:te(e,{isLegend:g,isXAxis:P,maxValue:d,backgroundColor:p.backgroundColor}),style:l,data:re(t,p,T,u),config:o,onClick:C=>n?n(C):f.noop},`dotPlot_${r}`)};try{x.displayName="DotPlot",x.__docgenInfo={description:"",displayName:"DotPlot",props:{plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Partial<Layout>"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Partial<Config>"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},style:{defaultValue:{value:"{ width: '100%', height: '100%' }"},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isLegend:{defaultValue:{value:"false"},description:"",name:"isLegend",required:!1,type:{name:"boolean"}},isXAxis:{defaultValue:{value:"false"},description:"",name:"isXAxis",required:!1,type:{name:"boolean"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!1,type:{name:"number"}},plotStyle:{defaultValue:{value:`{
    markerFill: '#515359',
    markerLine: '#515359',
    markerSize: 9,
    backgroundColor: 'transparent',
  }`},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},markerSymbols:{defaultValue:null,description:"",name:"markerSymbols",required:!1,type:{name:"Dictionary"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((e: Readonly<PlotMouseEvent>) => void)"}}}}}catch{}const ae=U(X);function le(t,o,e){o&&(t=t.filter(l=>l.y===o));const a=f.uniq(t.map(l=>l.group)).sort(),r=[],d=["(28,118,175,1)","rgba(91,176,181,1)"];return a.forEach((l,u)=>{const p=t.filter(n=>n.group===l);r.push({x:p.map(n=>n.x),y:p.map(n=>n.y),name:l,orientation:"h",marker:{color:e?e[l]:d[u],width:1},text:[l],hovertemplate:"%{x} %{text}<extra></extra>",textposition:"none",type:"bar"})}),r}function ie(t,{isTop:o,maxValue:e,backgroundColor:a}){const r=f.cloneDeep(t);return r.xaxis={visible:!1,range:[0,e]},a&&(r.plot_bgcolor=a,r.paper_bgcolor=a),o||(r.hoverlabel={font:{size:10}}),r.showlegend=!1,r.height=o?40:20,r}const S=({plotData:t,optionsConfig:o,isTop:e,layoutConfig:a,label:r,xMax:d,colors:l,plotStyle:u={backgroundColor:"transparent"},style:p={width:"100%",height:"100%"},onClick:n})=>i(ae,{style:p,layout:ie(a,{isTop:e,maxValue:d,backgroundColor:u.backgroundColor}),config:o,data:le(t,r,l),onClick:g=>n?n(g):f.noop});try{S.displayName="BarPlot",S.__docgenInfo={description:"",displayName:"BarPlot",props:{isTop:{defaultValue:null,description:"",name:"isTop",required:!0,type:{name:"boolean"}},style:{defaultValue:{value:"{ width: '100%', height: '100%' }"},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Partial<Layout>"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Partial<Config>"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!0,type:{name:"number"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"Dictionary"}},plotStyle:{defaultValue:{value:"{ backgroundColor: 'transparent' }"},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: Readonly<PlotMouseEvent>) => void)"}}}}}catch{}const _={displayModeBar:!1,responsive:!0,scrollZoom:!1,editable:!1,autosizable:!0},ne={delayShow:0,place:"right",type:"light",effect:"solid",border:!0},L={showlegend:!0,dragmode:!1,legend:{font:{size:11},y:1.1,xanchor:"right",x:1,orientation:"h"},xaxis:{visible:!0,fixedrange:!0,zeroline:!1,showgrid:!1,showline:!0,linecolor:"#ddd",autotick:!0,ticks:"outside",tickcolor:"#ddd"},yaxis:{fixedrange:!0,zeroline:!1,gridcolor:"#ddd",automargin:!0},margin:{pad:20},hovermode:"closest"},$={barmode:"stack",showlegend:!1,dragmode:!1,hovermode:"closest",yaxis:{visible:!1,fixedrange:!0},margin:{l:0,r:0,b:0,t:0,pad:0}};function q(t,{xField:o,yField:e,groupField:a,entityId:r,whereClause:d,infoField:l}){const u=`SELECT ${o} as "x", ${e} as "y", ${l?l+' as "info", ':""}   ${a} as "group" FROM ${r} ${d?" WHERE "+d:""}`;return K({concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:j,entityId:r,query:{sql:u}},t).then(n=>n.queryResult.queryResults)}function w(t,o){const e=t.reduce((r,d)=>(r[d[o]]=(d[o]in r?Number(r[d[o]]):0)+Number(d.x),r),{}),a=[];for(const r in e)a.push({[o]:r,count:e[r]});return a}const I=(t,o)=>{const e=t.points[0].data;let a=e.y[0],r=e.name;return o&&([a,r]=[r,a]),{facetValue:a,type:r,event:t.event}},se=(t,o)=>i("div",{className:"ThemesPlot__barPlotLegend",children:o.map((e,a)=>c("div",{style:{float:"left"},children:[i("div",{className:"ThemesPlot__barPlotLegend__label",style:{backgroundColor:`${t?t[e]:"transparent"}`}},"topBar_label"),i("div",{className:"ThemesPlot__barPlotLegend__graph",children:e},"topBar_graph")," "]},`topBar_${a}`))}),R=(t,o)=>{for(const e in t)t[e]=t[e].replace(",1)",`, ${o})`).replace(",1.0)",`, ${o})`);return t},de=(t,o)=>f.first(t.filter(e=>e.y===o).map(e=>e.info)),V=({dotPlot:t,topBarPlot:o,sideBarPlot:e,tooltipProps:a=ne,onPointClick:r,dotPlotYAxisLabel:d="Research Themes"})=>{const{accessToken:l}=J(),[u,p]=b.useState(!1),[n,g]=b.useState([]),[P,T]=b.useState([]),[C,Y]=b.useState([]);b.useEffect(()=>{const s=q(l,t),y=q(l,o),h=q(l,e);return Promise.all([s,y,h]).then(m=>{g(B(m[0].headers,m[0].rows)),T(B(m[1].headers,m[1].rows)),Y(B(m[2].headers,m[2].rows)),p(!0)}).catch(m=>{throw m}),()=>{}},[l,t,o,e]);let N=[],F=[],D=0,E=0,M=[],k=[];return u&&(k=w(C,"y"),N=k.sort((s,y)=>y.count-s.count).map(s=>s.y),E=Math.max(...k.map(s=>s.count)),D=Math.max(...n.map(s=>Number(s.x))),M=f.orderBy(w(P,"y"),["y"]),F=f.orderBy(w(P,"group"),["group"]).map(s=>s.group)),c(H,{children:[!u&&Z,u&&c("div",{className:"ThemesPlot",children:[i("div",{className:"ThemesPlot__dotPlotLegend",children:i(x,{id:"head",plotData:n,isLegend:!0,markerSymbols:t.markerSymbols,style:{width:"100%",height:"100%"},layoutConfig:L,optionsConfig:{..._,responsive:!0,staticPlot:!0},plotStyle:{...t.plotStyle,backgroundColor:"transparent"}})}),o.colors&&se(o.colors,F),M.map((s,y)=>c("div",{className:"ThemesPlot__topBarPlot",children:[c("div",{className:"ThemesPlot__topBarPlot__label",children:[s.count," ",W(s.y)]}),i("div",{className:"ThemesPlot__topBarPlot__plot",children:i(S,{style:{width:"100%",height:"100%"},layoutConfig:f.cloneDeep($),optionsConfig:{..._},plotData:P,isTop:!0,label:s.y,xMax:s.count,onClick:h=>r(I(h,!0)),colors:y%2===0?o.colors:R({...o.colors},"1")})})]},`topBarDiv_${y}`)),c("div",{style:{display:"flex",position:"relative"},children:[i("div",{className:"ThemesPlot__dotPlotYLabel",children:d}),c("div",{className:"ThemesPlot__dotPlot",children:[N.map((s,y)=>{var h,m;return c("div",{className:"ThemesPlot__dotPlot__row",style:{backgroundColor:(h=t.plotStyle)==null?void 0:h.backgroundColor},children:[i("div",{className:"ThemesPlot__dotPlot__barColumn",children:i(O,{tooltipText:`${de(n,s)} `,tooltipVisualProps:a,callbackFn:()=>f.noop,children:c("div",{children:[i("span",{className:"ThemesPlot__dotPlot__themeLabel",children:s}),i("br",{}),c("span",{className:"ThemesPlot__dotPlot__countLabel",children:[k[y].count," ",e.countLabel]}),i("br",{}),i(S,{style:{width:"100%"},layoutConfig:$,optionsConfig:_,plotData:C,isTop:!1,xMax:E,label:s,colors:R({...o.colors},"1")})]})})}),i("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",children:i("div",{style:{width:"100%",backgroundColor:(m=t.plotStyle)==null?void 0:m.backgroundColor},children:i(x,{id:`${y}`,onClick:G=>r(I(G,!1)),plotData:n,plotStyle:t.plotStyle,markerSymbols:t.markerSymbols,xMax:D,label:s,layoutConfig:L,optionsConfig:{..._,responsive:!1}})})})]},`plotDiv_${+y}`)}),c("div",{className:"ThemesPlot__dotPlot__row",children:[i("div",{className:"ThemesPlot__dotPlot__barColumn",style:{textAlign:"right"},children:"VOLUME:"}),i("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",style:{marginTop:"0px"},children:i(x,{id:"footer",plotData:n,isXAxis:!0,xMax:D,layoutConfig:L,optionsConfig:{..._,responsive:!1}})})]})]})]}),i("div",{})]})]})};try{V.displayName="ThemesPlot",V.__docgenInfo={description:"",displayName:"ThemesPlot",props:{onPointClick:{defaultValue:null,description:"",name:"onPointClick",required:!0,type:{name:"({ facetValue, type, event }: ClickCallbackParams) => void"}},dotPlot:{defaultValue:null,description:"",name:"dotPlot",required:!0,type:{name:"PlotProps"}},topBarPlot:{defaultValue:null,description:"",name:"topBarPlot",required:!0,type:{name:"PlotProps"}},sideBarPlot:{defaultValue:null,description:"",name:"sideBarPlot",required:!0,type:{name:"PlotProps"}},tooltipProps:{defaultValue:{value:`{
  delayShow: 0,
  place: 'right',
  type: 'light',
  effect: 'solid',
  border: true,
}`},description:"",name:"tooltipProps",required:!1,type:{name:"TooltipVisualProps"}},dotPlotYAxisLabel:{defaultValue:{value:"Research Themes"},description:"",name:"dotPlotYAxisLabel",required:!1,type:{name:"string"}}}}}catch{}const zt={title:"Home Page/ThemesPlot",component:V},v={args:{onPointClick:t=>{console.log(t.event)},topBarPlot:{entityId:"syn21641485",xField:"totalCount",yField:"groupBy",groupField:"consortium",colors:{CSBC:"rgba(64,123,160, 1)","PS-ON":"rgba(91,176,181,1)",ICBP:"rgba(197, 191, 223, 1)",TEC:"rgba(156, 196, 233, 1)"},whereClause:"totalCount is not NULL"},sideBarPlot:{entityId:"syn21649281",xField:"totalCount",yField:"theme",groupField:"consortium",countLabel:"grants",plotStyle:{backgroundColor:"#f5f9fa"},colors:{CSBC:"#1c76af","PS-ON":"#5bb0b5",ICBP:"#9cc4e9",TEC:"#c5bfdf"}},dotPlot:{entityId:"syn21639584",xField:"totalCount",yField:"theme",groupField:"groupBy",infoField:"themeDescription",whereClause:"groupBy IN ('publications', 'tools', 'datasets')",markerSymbols:{tools:"y-down",datasets:"diamond-x",publications:"circle"},plotStyle:{markerLine:"rgba(0, 0, 0,1)",markerFill:"rgba(255, 255, 255,1)",markerSize:11,backgroundColor:"#f5f9fa"}}}};var z,A,Q;v.parameters={...v.parameters,docs:{...(z=v.parameters)==null?void 0:z.docs,source:{originalSource:`{
  args: {
    onPointClick: e => {
      console.log(e.event);
    },
    topBarPlot: {
      entityId: 'syn21641485',
      xField: 'totalCount',
      yField: 'groupBy',
      groupField: 'consortium',
      colors: {
        CSBC: 'rgba(64,123,160, 1)',
        'PS-ON': 'rgba(91,176,181,1)',
        ICBP: 'rgba(197, 191, 223, 1)',
        TEC: 'rgba(156, 196, 233, 1)'
      },
      whereClause: 'totalCount is not NULL'
    },
    sideBarPlot: {
      entityId: 'syn21649281',
      xField: 'totalCount',
      yField: 'theme',
      groupField: 'consortium',
      countLabel: 'grants',
      plotStyle: {
        backgroundColor: '#f5f9fa'
      },
      colors: {
        CSBC: '#1c76af',
        'PS-ON': '#5bb0b5',
        ICBP: '#9cc4e9',
        TEC: '#c5bfdf'
      }
    },
    dotPlot: {
      entityId: 'syn21639584',
      xField: 'totalCount',
      yField: 'theme',
      groupField: 'groupBy',
      infoField: 'themeDescription',
      whereClause: "groupBy IN ('publications', 'tools', 'datasets')",
      markerSymbols: {
        tools: 'y-down',
        datasets: 'diamond-x',
        publications: 'circle'
      },
      plotStyle: {
        markerLine: 'rgba(0, 0, 0,1)',
        markerFill: 'rgba(255, 255, 255,1)',
        markerSize: 11,
        backgroundColor: '#f5f9fa'
      }
    }
  }
}`,...(Q=(A=v.parameters)==null?void 0:A.docs)==null?void 0:Q.source}}};const At=["ThemesPlotDemo"];export{v as ThemesPlotDemo,At as __namedExportsOrder,zt as default};
//# sourceMappingURL=ThemesPlot.stories-113cf1fc.js.map
